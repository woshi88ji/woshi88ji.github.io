<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<!-- <link rel="stylesheet" type="text/css" href="css/mui.min.css" /> -->
</head>

<body>
	<img src="./1080.png" id='image'>
	<!-- <script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script> -->
	<script>

		document.getElementById('image').onclick = (e) => {
			let target = e.target
			savePic(target);
		}
		
		/**
		 * 长按保存图片
		 * 1. 获取图片链接
		 * 2. 创建下载并下载图片
		 * 3. 保存至相册
		 */
		function savePic(target) {
			document.addEventListener("plusready", onPlusReady, false);
			// 扩展API加载完毕，现在可以正常调用扩展API 
			function onPlusReady() {
			}
			if (target.tagName == 'IMG' && target.currentSrc.length > 0 && target.id === 'image') { //确保图片链接不为空
				var imgUrl = target.src;
				var suffix = cutImageSuffix(imgUrl);
				
				(function() {
					var result = confirm('是否保存图片')
					if(result) {
						var downLoader = plus.downloader.createDownload(imgUrl, {
							method: 'GET',
							filename: '_downloads/image' + suffix
						}, function (download, status) {
							var fileName = download.filename;
							if (status == 200) {
							plus.gallery.save(fileName, function () {
									alert('下载成功!')
								});
							} else {
								alert("下载失败, 请重试!");
							}
							
						});
						/**
						 * 开始下载任务
						 */
						downLoader.start();
					}
				})()
			}
		}
		// 截取图片后缀用于重命名图片，防止%E5%85%89%E6%98%8E%E8%A1%8C编码的文件不被系统相册识别；
		function cutImageSuffix(imageUrl) {
			var index = imageUrl.lastIndexOf('.');
			return imageUrl.substring(index);
		}
	</script>
</body>

</html>