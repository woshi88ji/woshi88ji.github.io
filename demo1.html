<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Downloader Example</title>
	<script type="text/javascript">
		// 扩展API加载完毕后调用onPlusReady回调函数 
		document.addEventListener("plusready", onPlusReady, false);
		var r = null;
		// 扩展API加载完毕，现在可以正常调用扩展API 
		function onPlusReady() {
		}
		// 创建下载任务
		function createDownload() {
			var dtask = plus.downloader.createDownload("https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1562490396179&di=b9ed2ed6c9ab202a2ebd0270b973e32e&imgtype=0&src=http%3A%2F%2Fimg.mpaypass.com.cn%2Fimages%2F20170120090443.png", {
				  method: 'GET',
				filename: '_downloads/image.png'
			}, function (d, status) {
				// 下载完成
				 var fileName = download.filename;
				alert('文件名:' + fileName);
				alert('下载状态：' + status);
				/**
				 * 保存至本地相册
				 */
				// plus.gallery.save(fileName, function () {
				// 	/**
				// 	 * 保存后，弹出对话框是否查看；
				// 	 */
				// 	mui.confirm("打开相册查看", "", ["打开", "取消"], function (event) {
				// 		var gindex = event.index;
				// 		if (gindex == 0) {
				// 			/**
				// 			 * 选择图片
				// 			 */
				// 			plus.gallery.pick(function (file) {
				// 				mui.toast("你选择了图片：" + file);
				// 			}, function (error) {
				// 				console.log(JSON.stringify(error));
				// 			}, {

				// 				});
				// 		}
				// 	});
				// });

				if (status == 200) {
					alert("Download success: " + d.filename);
				} else {
					alert("Download failed: " + status);
				}
			});
			//dtask.addEventListener("statechanged", onStateChanged, false);
			dtask.start();
		}
	</script>
</head>

<body>
	<button id="download" onclick="createDownload()">Create download task</button>
</body>

</html>